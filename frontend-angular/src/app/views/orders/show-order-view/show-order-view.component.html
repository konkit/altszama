<ng-container *ngIf="orderResponse$ | async as orderResponse">
  <ng-container *ngIf="showOrderViewState$ | async as viewState">
    <ng-container *ngIf="modifyOrderEntryState$ | async as modifyOrderEntryState">
      <app-view-wrapper
        [title]="'[' + orderResponse.order.orderState + '] Order from ' + orderResponse.order.restaurantName + ' (' + orderResponse.order.orderDate + ')'">

        <div *ngIf="viewState.shouldShowOrderLockedWarning">
          <!-- TODO: Change to material banner -->

          <mat-card class="my-5">
            <mat-card-header><strong>The order is locked!</strong></mat-card-header>

            <mat-card-content>
              The order is locked in ordering state and the order entries are
              freezed.<br/>
              If you are not ordering yet, click button to go back to created state.
            </mat-card-content>

            <mat-card-actions>
              <app-button color="primary" (click)="unlockOrder()" [icon]="faUnlock" class="ml-2">
                Unlock
              </app-button>
              <app-button color="primary" (click)="placeOrder()" [icon]="faArrowRight" class="ml-2">
                Place order<span class="fa fa-arrow-right"></span>
              </app-button>
            </mat-card-actions>
          </mat-card>
        </div>

        <div class="flex flex-row py-3" *ngIf="viewState.isOrderOwner">
          <div class="flex">
            <ng-container *ngIf="viewState.canShowPlaceOrderButton && viewState.isPlaceOrderButtonDisabled">
              <app-button class="mr-3" [disabled]="true" [icon]="faArrowRight" matTooltip="You cannot place an empty order. Choose a dish first.">
                Place order
              </app-button>
            </ng-container>

            <ng-container *ngIf="viewState.canShowPlaceOrderButton && !viewState.isPlaceOrderButtonDisabled">
              <app-button class="mr-3" color="primary" (click)="placeOrder()" [icon]="faArrowRight">
                Place order
              </app-button>
            </ng-container>

            <app-button class="mr-3" color="primary" *ngIf="viewState.canShowMarkAsDeliveredButton" (click)="setAsDelivered()" [icon]="faArrowRight">
              Mark as delivered
            </app-button>

            <app-button class="mr-3" (click)="goToEditOrder()" [icon]="faPencil">
              Edit order
            </app-button>

            <app-button class="mr-3" color="warn" (click)="deleteOrder()" [icon]="faTimes">
              Delete order <i class="pl-2 fa fa-cog" aria-hidden="true"></i>
            </app-button>
          </div>
        </div>

        <div class="grid grid-cols-3">
          <div>
            <h2>Order details</h2>
            <app-order-data-summary [order]="orderResponse.order"></app-order-data-summary>
          </div>

          <div>
            <h2>Price summary</h2>
            <app-price-summary [priceSummaryInput]="viewState.priceSummaryInput"></app-price-summary>
          </div>

          <div>
            <h2>Payment options</h2>
            <app-payment-options-summary [paymentData]="orderResponse.order.paymentData"
                                         [showOrderResponse]="orderResponse"
                                         [viewState]="viewState"></app-payment-options-summary>
          </div>
        </div>

        <div>
          <div class="flex flex-row flex-wrap">
            <div class="mr-4 py-5">
              <b class="mr-2">See the menu at:</b>
              <a class="text-indigo-500" *ngIf="orderResponse.order.restaurantUrl" target="_blank"
                 [href]="orderResponse.order.restaurantUrl">{{ orderResponse.order.restaurantUrl }}</a>
              <i *ngIf="!orderResponse.order.restaurantUrl">Sorry, no menu url specified</i>
            </div>
          </div>
        </div>

        <app-order-entries-list [showOrderResponse]="orderResponse"
                                [viewState]="viewState"
                                [modifyOrderEntryState]="modifyOrderEntryState">
        </app-order-entries-list>
      </app-view-wrapper>
    </ng-container>
  </ng-container>
</ng-container>
